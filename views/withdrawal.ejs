<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdraw</title>
    <link rel="stylesheet" href="/witdraw.css">
    <link rel="shortcut icon" href="/logo.svg" type="image/x-icon">
    <style>
         .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            transform: translateX(150%);
            transition: transform 0.3s ease-in-out;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #48BB78;
            color: white;
        }
        
        .notification.error {
            background-color: #F56565;
            color: white;
        }
        
        .notification-icon {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .close-notification {
            margin-left: 15px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>

</head>

<body class="bg-gray-100">
    <!-- Your header/navigation -->
<div id="notification" class="notification">
        <span id="notification-message"></span>
    </div>
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="max-w-2xl mx-auto">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Withdraw Funds</h2>

                <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                    <p class="text-blue-800 font-semibold">Current Earn Balance: <span id="current-balance">
                              <%= Math.floor(user.earn) %>
                        </span> PKR</p>
                </div>

                <form id="withdrawal-form" class="space-y-6">
                    <div>
                        <label for="withdrawal-method" class="block text-sm font-medium text-gray-700 mb-2">Withdrawal
                            Method <span class="text-red-500">*</span></label>
                        <select id="withdrawal-method"
                            class="w-full bg-white rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            required>
                            <option value="">Select method</option>
                            <option value="easypaisa">EasyPaisa</option>
                            <option value="jazzcash">JazzCash</option>
                            <option value="bank">Bank Transfer</option>
                        </select>
                    </div>

                    <div>
                        <label for="account-details" class="block text-sm font-medium text-gray-700 mb-2">Account
                            Details <span class="text-red-500">*</span></label>
                        <input type="text" id="account-details"
                            class="w-full bg-white rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="e.g., 03101234567" required>
                    </div>

                    <div>
                        <label for="withdrawal-amount" class="block text-sm font-medium text-gray-700 mb-2">Amount (PKR)
                            <span class="text-red-500">*</span></label>
                        <input type="number" id="withdrawal-amount"
                            class="w-full bg-white rounded-lg border border-gray-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Enter withdrawal amount" min="500" step="1" required>
                    </div>

                    <button type="submit"
                        class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                        Request Withdrawal
                    </button>
                </form>

                <!-- Message container (initially hidden) -->
                <div id="message-container" class="mt-4 hidden">
                    <div id="message-content" class="p-4 rounded-lg"></div>
                </div>
            </div>
        </div>
    </main>
    <nav class="fixed bottom-0 w-full bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.1)] flex justify-around py-3 z-50">
        <a href="#" id="homebtn" class="flex flex-col items-center text-blue-700 px-2">
            <svg class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span class="text-xs md:text-sm">Home</span>
        </a>
        <a href="#" id="assetsbtn" class="flex flex-col items-center text-gray-500 hover:text-blue-600 px-2">
            <svg class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <span class="text-xs md:text-sm">Assets</span>
        </a>
        <a href="#" id="teambtn2" class="flex flex-col items-center text-gray-500 hover:text-blue-600 px-2">
            <svg class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <span class="text-xs md:text-sm">Team</span>
        </a>
        <a href="#" id="profilebtn"
            class="flex flex-col items-center text-gray-500 hover:text-blue-600 px-2 transition-colors duration-200 group"
            aria-label="User profile">
            <svg class="h-6 w-6 text-blue-700 group-hover:text-blue-600" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <span class="text-xs md:text-sm group-hover:text-blue-600">Profile</span>
        </a>
    </nav>
    <script>
      
    // Navigation button handlers
    document.getElementById("teambtn2").addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = '/team';
    });

    document.getElementById("assetsbtn").addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = '/assets';
    });

    document.getElementById("profilebtn").addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = '/profile';
    });

    document.getElementById("homebtn").addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = '/home';
    });

    // Show notification
    function showNotification(message, type) {
        const notification = document.getElementById('notification');
        const messageElement = document.getElementById('notification-message');

        messageElement.textContent = message;
        notification.className = 'notification ' + type;

        // Show notification with animation
        notification.classList.remove('hidden');
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);

        // Auto-hide after 5 seconds
        setTimeout(() => {
            hideNotification();
        }, 5000);
    }

    // Hide notification
    function hideNotification() {
        const notification = document.getElementById('notification');
        notification.classList.remove('show');
        setTimeout(() => {
            notification.classList.add('hidden');
        }, 300);
    }

    // Form submission handler
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('withdrawal-form');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                amount: document.getElementById('withdrawal-amount').value,
                method: document.getElementById('withdrawal-method').value,
                accountDetails: document.getElementById('account-details').value
            };

            if (parseFloat(formData.amount) < 500) {
                showNotification('Minimum withdrawal amount is 500 PKR', 'error');
                return;
            }

            try {
                const response = await fetch('/api/withdrawals/withdraw', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    showNotification('Withdrawal request sent for approval!', 'success');
                    form.reset();

                    if (data.updatedBalance) {
                        document.getElementById('current-balance').textContent = data.updatedBalance;
                    }
                } else {
                    showNotification(data.message || 'Withdrawal request failed', 'error');
                }
            } catch (error) {
                console.error('Withdrawal error:', error);
                showNotification('An error occurred while submitting your withdrawal request', 'error');
            }
        });
    });


    </script>

</body>

</html>